import{k as E,q as I,u as F,_ as g,j as e,L as q,a as L,r as m,v as M,p as N,i as R,g as p}from"./index-CTXLcj4T.js";import{u as A,B as D,a as G,b as K}from"./BookingDataBox-BxsPOBg1.js";import{u as Q}from"./apiBookings-BZcizHZ7.js";import{f as d}from"./helpers-BuJpLv72.js";import{E as j}from"./ErrorMsg-BBbHNTyV.js";import{R as T}from"./Row-DJ7VZngJ.js";import{C as b}from"./Checkbox--tLsPYCN.js";import{u as _}from"./useSettings-D4UYzl6H.js";import"./Flag-zG777W3T.js";import"./format-C2OtfDDC.js";import"./isToday-DdsJfKPO.js";import"./constants-BUW7qVOF.js";function z(){const i=E(),a=I(),{mutate:s,isPending:n}=F({mutationFn:({bookingId:t,breakfast:o})=>Q(t,{status:"checked-in",isPaid:!0,...o}),onSuccess:t=>{g.success(`Booking #${t.id} successfully checked in`),i.invalidateQueries({active:!0}),a("/")},onError:()=>{g.error("There was an error while checking in")}});return{checkin:s,isCheckingIn:n}}function H({addBreakfast:i,setAddBreakfast:a,setPrice:s,onChange:n,numNights:t,numGuests:o}){const{settings:u,isPending:r,error:f}=_();if(r)return e.jsx(q,{duration:2e3,additionalStyle:"height: 4.5rem;"});if(f)return g.error("Something went wrong while loading breakfast price"),e.jsx(j,{faildFor:"breakfast price",queryKey:["settings"]});const{breakfastPrice:x}=u,k=x*o*t;return e.jsxs(b,{checked:i,onChange:()=>{a(c=>!c),n==null||n(),s==null||s(k)},children:["Want to add breakfast for ",d(k)," ?"]})}const B=L.div`
  /* Box */
  background-color: var(--color-grey-0);
  border: 1px solid var(--color-grey-100);
  border-radius: var(--border-radius-md);
  padding: 2.4rem 4rem;
`;function W(){const[i,a]=m.useState(!1),[s,n]=m.useState(!1),t=M(),{checkin:o,isCheckingIn:u}=z(),{booking:r,bookingId:f,isLoading:x,error:k}=A(),[c,C]=m.useState(0);if(m.useEffect(()=>{a((r==null?void 0:r.isPaid)??!1)},[r==null?void 0:r.isPaid]),x)return e.jsx(N,{});if(k)return g.error("Check in details can't be loaded"),e.jsx(j,{faildFor:`booking #${f}`,queryKey:["booking",f]});const{id:l,guests:v,totalPrice:h,numGuests:y,hasBreakfast:P,numNights:S}=r;function $(){i&&o(s?{bookingId:l,breakfast:{hasBreakfast:!0,extrasPrice:c,totalPrice:h+c}}:{bookingId:l,breakfast:{}})}return e.jsxs(e.Fragment,{children:[e.jsxs(T,{$type:"horizontal",children:[e.jsxs(R,{as:"h1",children:["Check in booking #",l]}),e.jsx(D,{onClick:t,children:"← Back"})]}),e.jsx(G,{booking:r}),!P&&e.jsx(B,{children:e.jsx(H,{addBreakfast:s,setAddBreakfast:n,numGuests:y,numNights:S,onChange:()=>a(!1),setPrice:C})}),e.jsx(B,{children:e.jsxs(b,{checked:i,onChange:()=>a(w=>!w),disabled:i||u,children:["I confirm that ",v.fullName," has paid the total amount of"," ",s?`${d(h+c)}(${d(h)} + ${d(c)})`:d(h)]})}),e.jsxs(K,{children:[e.jsxs(p,{onClick:$,disabled:!i||u,children:["Check in booking #",l]}),e.jsx(p,{$variation:"secondary",onClick:t,children:"Back"})]})]})}function ae(){return e.jsx(W,{})}export{ae as default};
