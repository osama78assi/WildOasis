import{m,k as j,n as p,u as y,_ as x,j as e,M as c,o as G,p as M,r as R,h as D,i as F}from"./index-CTm8NVWJ.js";import{R as o}from"./constants-BUW7qVOF.js";import{u as E,E as S,R as q}from"./ErrorMsg-uRNUnxFp.js";import{g as h,d as w}from"./apiGuests-DZsNAcem.js";import{P as v}from"./Pagination-CAvVVG_l.js";import{T as u}from"./Table-DM4GalzS.js";import{M as g,C}from"./ConfirmDelete-BoF-LdvJ.js";import{R as f}from"./Row-C4B0ieHd.js";function Q(){const[n]=m(),t=j(),s=n.get("page")?+n.get("page"):1,{data:{guests:r,count:i}={},isPending:a,error:d}=p({queryKey:["guests",s],queryFn:()=>h(s,o)}),l=Math.ceil(i/o);return s<l&&!t.getQueryData(["guests",s+1])&&t.prefetchQuery({queryKey:["guests",s+1],queryFn:()=>h(s+1,o)}),s>1&&!t.getQueryData(["guests",s-1])&&t.prefetchQuery({queryKey:["guests",s-1],queryFn:()=>h(s-1,o)}),{guests:r,isLoading:a,count:i,error:d,page:s}}function b(){const n=j(),{mutate:t,isPending:s}=y({mutationFn:({id:r})=>w(r),onSuccess:()=>{n.invalidateQueries({active:!0}),x.success("Guest deleted successfully")},onError:()=>x.error("Somthing went wrong")});return{deleteGuest:t,isDeleting:s}}function P({id:n}){const{deleteGuest:t,isDeleting:s}=b();function r(){t({id:n})}return e.jsxs(g,{children:[e.jsxs(c,{id:`geust${n}`,children:[e.jsx(c.Toggle,{}),e.jsx(c.List,{children:e.jsx(g.Open,{opens:"delete-guest",children:e.jsx(c.Button,{Icon:G,disabled:s,children:"Delete"})})})]}),e.jsx(g.Window,{popup:!0,name:"delete-guest",children:e.jsx(C,{resourceName:"Guest",onConfirm:r,moreDetails:"it will delete all bookings for this guest",disabled:s})})]})}function T({guest:n}){const{id:t,fullName:s,email:r,nationalID:i,nationality:a}=n;return e.jsxs(u.Row,{children:[e.jsx("span",{children:s}),e.jsx("span",{children:r}),e.jsx("span",{children:i}),e.jsx("span",{children:a}),e.jsx(P,{id:t})]})}function _(){const{guests:n,isLoading:t,count:s,error:r,page:i}=Q(),{isFetching:a,reFetch:d}=E();return t?e.jsx(M,{}):r?e.jsx(S,{faildFor:"Guests",queryKey:["guests",i]}):e.jsxs(u,{columns:"repeat(4, 1fr) auto",children:[e.jsxs(u.Header,{children:[e.jsx("div",{children:"Full name"}),e.jsx("div",{children:"Email"}),e.jsx("div",{children:"national ID"}),e.jsx("div",{children:"nationality"}),e.jsx(q,{isFetching:a,onClick:d,disabled:a})]}),e.jsx(u.Body,{data:n,render:l=>e.jsx(T,{guest:l},l.id)}),e.jsx(u.Footer,{children:e.jsx(v,{count:s,pageSize:o})})]})}function B(){const[n,t]=R.useState("h1");return D(500,()=>t("h2"),()=>t("h1")),e.jsxs(e.Fragment,{children:[e.jsx(f,{style:{overflow:"visible"},children:e.jsx(F,{as:n,children:"Guests"})}),e.jsx(f,{children:e.jsx(_,{})})]})}export{B as default};
