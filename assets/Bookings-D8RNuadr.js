import{m as $,k as K,n as L,a as M,q as Q,j as e,M as u,w as _,x as z,y as G,o as U,p as W,_ as I,r as q,h as H,i as B}from"./index-YsPsgoZE.js";import{a as O}from"./constants-BUW7qVOF.js";import{u as J,E as V,R as X}from"./ErrorMsg-BbDCffis.js";import{g as S}from"./apiBookings-P27w9yLR.js";import{E as Y,C as D,S as m}from"./SortBy-Bleb16W7.js";import{P as Z}from"./Pagination-ZlmGimCF.js";import{T as p}from"./Table-Cyymo2pz.js";import{u as ee,T as te}from"./Tag-BOvixrQ1.js";import{u as ne}from"./useDeleteBooking-Hcv1OHiD.js";import{b as oe,f as re}from"./helpers-xEQtM6Ts.js";import{M as b,C as se}from"./ConfirmDelete-DXoR0ITl.js";import{i as ie}from"./isToday-D1cjrOTQ.js";import{f as T}from"./format-CpomdRbd.js";import{R as F}from"./Row-DxrECGZI.js";import{F as x}from"./Filter-4CmaXF4q.js";function ae(n){const{filterName:t,field:c,filterMethod:l,sortBy:g,defaultSort:s,resultPerPage:f}=n,[i]=$(),d=K(),h=i.get(t),o={field:c,value:h==="all"||!h?null:h,filterMethod:l},j=i.get(g)||s,[y,k]=j.split("-"),a={sortField:y,sortDirection:k},r=i.get("page")?+i.get("page"):1,C=["bookings",o,a,r],{data:{count:w,bookings:N}={},error:E,isPending:R}=L({queryKey:C,queryFn:()=>S(o,a,r)}),A=Math.ceil(w/f);return r<A&&d.prefetchQuery({queryKey:["bookings",o,a,r+1],queryFn:()=>S(o,a,r+1),staleTime:0}),r>1&&d.prefetchQuery({queryKey:["bookings",o,a,r-1],queryFn:()=>S(o,a,r-1)}),{bookings:N,isLoading:R,error:E,count:w,queryKey:C,page:r}}const ce=M.div`
  font-size: 1.6rem;
  font-weight: 600;
  color: var(--color-grey-600);
  font-family: "Sono";
`,P=M.div`
  display: flex;
  flex-direction: column;
  gap: 0.2rem;

  & span:first-child {
    font-weight: 500;
  }

  & span:last-child {
    color: var(--color-grey-500);
    font-size: 1.2rem;
  }
`,le=M.div`
  font-family: "Sono";
  font-weight: 500;
`;function de({booking:{id:n,startDate:t,endDate:c,numNights:l,totalPrice:g,status:s,guests:{fullName:f,email:i},cabins:{name:d}},position:h}){const v={unconfirmed:"blue","checked-in":"green","checked-out":"silver"},o=Q(),{checkOut:j,isCheckingOut:y}=ee(),{deleteFn:k,isDeleting:a}=ne();return e.jsxs(p.Row,{children:[e.jsx(ce,{children:d}),e.jsxs(P,{children:[e.jsx("span",{children:f}),e.jsx("span",{children:i})]}),e.jsxs(P,{children:[e.jsxs("span",{children:[ie(new Date(t))?"Today":oe(t)," ","→ ",l," night stay"]}),e.jsxs("span",{children:[T(new Date(t),"MMM dd yyyy")," —"," ",T(new Date(c),"MMM dd yyyy")]})]}),e.jsx(te,{$type:v[s],children:s.replace("-"," ")}),e.jsx(le,{children:re(g)}),e.jsx(b,{children:e.jsxs(u,{id:n,children:[e.jsx(u.Toggle,{}),e.jsxs(u.List,{position:h,children:[e.jsx(u.Button,{Icon:_,onClick:()=>o(`/booking/${n}`),children:"Show detials"}),s==="unconfirmed"&&e.jsx(u.Button,{Icon:z,onClick:()=>o(`/checkin/${n}`),children:"Check in"}),s==="checked-in"&&e.jsx(u.Button,{Icon:G,onClick:()=>j(n),disabled:y,children:"Check Out"}),e.jsx(b.Open,{opens:"delete-booking",children:e.jsx(u.Button,{Icon:U,children:"Delete Booking"})})]}),e.jsx(b.Window,{popup:!0,name:"delete-booking",children:e.jsx(se,{resourceName:"Booking",onConfirm:()=>k(n),disabled:a})})]})})]})}function he(){const n={filterName:"status",field:"status",filterMethod:"eq",sortBy:"sortBy",defaultSort:"startDate-desc",resultPerPage:O},{bookings:t,error:c,isLoading:l,count:g,queryKey:s}=ae(n),{isFetching:f,reFetch:i}=J(s);return l?e.jsx(W,{}):c?(I.error("Cabins couldn't be loaded",{duration:5e3}),e.jsx(V,{faildFor:"bookings"})):t.length?e.jsxs(p,{columns:"1fr 2fr 1.4fr 1.4fr 1fr 3.2rem",additionStyles:"column-gap: 1.4rem;",fixWidthAt:775,children:[e.jsxs(p.Header,{children:[e.jsx("div",{children:"Cabin"}),e.jsx("div",{children:"Guest"}),e.jsx("div",{children:"Dates"}),e.jsx("div",{children:"Status"}),e.jsx("div",{children:"Amount"}),e.jsx(X,{disabled:f,onClick:i,isFetching:f})]}),e.jsx(p.Body,{data:t,render:(d,h)=>e.jsx(de,{booking:d,position:h===t.length-1&&t.length!==1?"top-left":"bottom-left"},d.id)}),e.jsx(p.Footer,{children:e.jsx(Z,{count:g,pageSize:O})})]}):e.jsx(Y,{resource:"Bookings"})}function ue(){const[n,t]=q.useState("h2");return H(500,()=>t("h3"),()=>t("h2")),e.jsxs(F,{$type:"vertical",style:{gap:"1rem",overflow:"unset"},children:[e.jsxs(D,{children:[e.jsx(B,{as:n,$txt:"left",children:"Filter"}),e.jsxs(x,{filterFor:"status",collapseAt:700,defaultFilter:"all",clearSearchOnClick:["page"],children:[e.jsx(x.FilterButton,{filter:"all",children:"All"}),e.jsx(x.FilterButton,{filter:"checked-out",children:"Checked out"}),e.jsx(x.FilterButton,{filter:"checked-in",children:"Checked in"}),e.jsx(x.FilterButton,{filter:"unconfirmed",children:"Unconfirmed"})]})]}),e.jsxs(D,{children:[e.jsx(B,{as:n,children:"Sort"}),e.jsxs(m,{sortFor:"sortBy",type:"white",getMinAt:700,activeLable:"Sort by date (recent first)",children:[e.jsx(m.SelectOption,{value:"startDate-desc",children:"Sort by date (recent first)"}),e.jsx(m.SelectOption,{value:"startDate-asc",children:"Sort by date (earlier first)"}),e.jsx(m.SelectOption,{value:"totalPrice-desc",children:"Sort by amount (high first)"}),e.jsx(m.SelectOption,{value:"totalPrice-asc",children:"Sort by amount (low first)"})]})]})]})}function we(){const[n,t]=q.useState("h1");return H(500,()=>t("h2"),()=>t("h1")),e.jsxs(e.Fragment,{children:[e.jsxs(F,{$type:"horizontal",style:{overflow:"unset",columnGap:"0.5rem"},children:[e.jsx(B,{as:n,children:"All bookings"}),e.jsx(ue,{})]}),e.jsx(F,{style:{height:"45rem"},children:e.jsx(he,{})})]})}export{we as default};
